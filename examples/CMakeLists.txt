CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

FILE(GLOB FILES "*/*.cpp")

MACRO(CREATE_EXAMPLES BACKEND)
    STRING(TOUPPER ${BACKEND} DEF_NAME)
    FOREACH(FILE ${FILES})
        GET_FILENAME_COMPONENT(EXAMPLE ${FILE} NAME_WE)
        GET_FILENAME_COMPONENT(FULL_DIR_NAME ${FILE} DIRECTORY)
        GET_FILENAME_COMPONENT(DIR_NAME ${FULL_DIR_NAME} NAME)
        SET(EXAMPLE_NAME example_${DIR_NAME}_${EXAMPLE}_${BACKEND})

        ADD_EXECUTABLE(${EXAMPLE_NAME} ${FILE})
        TARGET_LINK_LIBRARIES(${EXAMPLE_NAME} af${BACKEND} ${THREAD_LIB_FLAG})
        SET_TARGET_PROPERTIES(${EXAMPLE_NAME}
                               PROPERTIES
                               COMPILE_FLAGS -DAF_${DEF_NAME}
                               OUTPUT_NAME ${EXAMPLE}_${BACKEND}
                               RUNTIME_OUTPUT_DIRECTORY ${DIR_NAME})
     ENDFOREACH()
ENDMACRO(CREATE_EXAMPLES)


IF(${BUILD_CPU})
  CREATE_EXAMPLES(cpu)
ENDIF()

IF(${BUILD_CUDA})
  CREATE_EXAMPLES(cuda)
ENDIF()

IF(${BUILD_OPENCL})
  CREATE_EXAMPLES(opencl)
ENDIF()

INCLUDE_DIRECTORIES(
    "${CMAKE_CURRENT_SOURCE_DIR}"
)
